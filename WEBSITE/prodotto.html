<!DOCTYPE html>
<html lang="it">
    
    <head>
        
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="description" content="Tim Project Hypermedia Application Course 2016">
        
        <title>
            TIM - Prodotto
        </title>
        
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/bootstrap-theme.css">
        <link rel="stylesheet" href="css/tim/tim-components.css">
        <link rel="stylesheet" href="css/tim/device.css">
        <link rel="stylesheet" href="css/tim/utility-classes.css">
        <link rel="stylesheet" href="css/tim/mobile.css">
        
    </head>
    
    <body>
    
        <!-- HEADER START -->
		<nav class="navbar navbar-default tim-header">
			<div class="container-fluid">
				<div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
					<a class="navbar-brand timbrand" href="index.html">
						<img alt="TIM" src="img/logo.png">
					</a>
				</div>
                
                <div class="collapse navbar-collapse" id="header">
                    <ul class="nav navbar-nav">
                        <li><a href="innovazione.html" class="menu-textcolor">Chi siamo</a></li>
                        <li><a href="#" class="menu-textcolor">Il gruppo</a></li>
                    </ul>
                    
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="intro_prodotti.html" class="menu-textcolor">PRODOTTI</a></li>
                        <li><a href="intro_sls.html" class="menu-textcolor">SMARTLIFE</a></li>
                        <li><a href="intro_assistenza.html" class="menu-textcolor">ASSISTENZA</a></li>
                        <a class="navbar-brand cartbrand" href="carrello.html">
                            <img class="cartlogo" alt="Carrello" src="img/cart.png">
                        </a>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- HEADER END -->
        
        <ol id="breadcrumb" class="breadcrumb"><!-- Breadcrumb --></ol>
        
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-10 col-sm-offset-1 col-md-5 col-md-offset-1">
                    <div class="row hidden-xs">
                        <div id="img_dev" class="col-sm-2"><!-- Thumbnails --></div>
                        <div id="main_img" class="col-sm-8"><!-- Main Image --></div>
                    </div>
                    <div class="row visible-xs">
                        <div class="col-xs-12">
                            <div class="container">
                                <div id="myCarousel" class="carousel slide" data-ride="carousel">
                                    <!-- Indicators -->
                                    <ol class="carousel-indicators"><!-- data-target --></ol>

                                    <!-- Wrapper for slides -->
                                    <div class="carousel-inner" role="listbox"><!--Items --></div>

                                    <!-- Left and right controls -->
                                    <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                    <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </div>
                             </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-xs-10 col-xs-offset-1 col-sm-10 col-sm-offset-1 col-md-5">
                    <div class="row">
                        <div id="nome_dispositivo" class="nome-device" class="col-xs-12"><!-- Nome Device --></div>
                    </div>
                    
                    <div class="row">                    
                        <div id="caratteristiche" class="col-xs-12"><!-- Caratteristiche -->
                            <h3>Caratteristiche:</h3>
                        </div>
                    </div>

                    <div class="row">
                        <div id="memoria" class="col-xs-12"><!-- Memoria --></div>
                    </div>

                     <div class="row">
                        <div id="colori_device" class="col-xs-12"><!-- Colori --></div>
                    </div>

                </div>
            </div>
            
            <div class="row">
                <div class="col-sm-8 col-sm-offset-1 col-md-5 col-md-offset-1">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-0"><!-- Prezzo Intero -->
                            <div class="checkbox">
                                <label class="tim-cbtext">
                                    <input type="radio" name="optradio"> Unica soluzione
                                </label>
                            </div>
                            <p id="prezzo_intero" class="tim-pricetext"></p>
                        </div>

                        <div id="prezzo_rate" class="col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-0"><!-- Prezzo Rate--></div>
                    </div>
                </div>

                <div class="col-sm-3 col-md-5 col-md-offset-1">
                    <div class="row">
                        <div id="link-acquista" class="col-xs-12 col-sm-10 text-center"><!-- Link per l'acquisto --></div>
                    </div>
                </div> 
            </div>
            
            <div class="row">
                <div class="col-xs-10 col-xs-offset-1">
                    <ul id="myTab" class="nav nav-tabs"><!-- Titolo Schede --></ul>
                    <div id="myTabContent" class="tab-content"><!-- Contenuto Schede --></div>
                </div> 
            </div>
        </div>
        
        <!-- FOOTER START -->
        <footer class="footer">
            <div class="container-fluid">
                <div class="row no-margin">
                    <div class="col-sm-6">
                        <div class="row footer-row">
                            <div class="col-xs-6 col-sm-4 col-lg-3 vertical-align">
                                <p class="footer-text">Privacy</p>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-lg-3 vertical-align">
                                <p class="footer-text">Note Legali</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="row footer-row">
                            <div class="col-xs-3 col-sm-2 col-sm-offset-4 col-lg-1 col-lg-offset-8 vertical-align">
                                <img src="img/social-icon/facebook-logo.png" class="img-responsive" alt="Facebook">
                            </div>
                            <div class="col-xs-3 col-sm-2 col-lg-1 vertical-align">
                                <img src="img/social-icon/twitter-logo.png" class="img-responsive" alt="Twitter">
                            </div>
                            <div class="col-xs-3 col-sm-2 col-lg-1 vertical-align">
                                <img src="img/social-icon/youtube.png" class="img-responsive" alt="Youtube">
                            </div>
                            <div class="col-xs-3 col-sm-2 col-lg-1 vertical-align">
                                <img src="img/social-icon/google-plus-logo.png" class="img-responsive" alt="Google Plus">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- FOOTER END -->
        
        <script src="js/jquery-1.12.4.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/bootstrap-tabcollapse.js"></script>
        <script src="js/get.js"></script>
        
        <script type="text/javascript">
            
            $(document).ready(function(){
                
                var idCategoria = $_GET("idCategoria");
                var idDevice = $_GET("idDevice");
                getCategoria(idCategoria);
                getDevice(idDevice);
                
                /*
                    Cambio immagini in base al colore
                */
                $("#colori_device").on("click", "div div", function(e) {
                    e.preventDefault();
                    $("#colori_device").children("div").children("div").removeClass("active-color");
                    var idImmagine = $(this).attr("id");
                    var idDevice = $_GET("idDevice");
                    get_img(idDevice, idImmagine);
                    $(this).addClass("active-color");
                });
                
                /*
                    Transizioni immagini
                */
                $("#img_dev").on("click", "a img", function(e){
                    e.preventDefault();
                    $("#img_dev").children("a").removeClass("thumb-active");
                    $(this).closest("a").addClass("thumb-active");
                    var src = this.src;
                    $(".img-dev").fadeOut(400,function(){
                        $(this).fadeIn(400)[0].src = src;
                    });
                });
                
            });
            
            function getCategoria(idCategoria) { 
                
                var data = {
                    "action": "get_categoria",
                    "idCategoria": idCategoria
                };
                data = $(this).serialize() + "&" + $.param(data);
                
                $.ajax({
                    type: "GET",
                    dataType: "json",
                    url: "http://timwebapp-hypcourse2016.rhcloud.com/api/get_devices.php",
                    data: data,
                    success: function(data) {
                        
                        console.log(data["json"]);
                         
                        /*
                            Breadcrumb
                        */
                        $("#breadcrumb").html(
                            '<li><a href="intro_prodotti.html">PRODOTTI</a></li>'+
                            '<li><a href="lista_prodotti.html?idCategoria='+data["idCategoria"]+'">'+data["nome"]+'</a></li>'
                        );
                        
                    }
                    
                    
                });
                
                return false;
                
            }
            
            function getDevice(idDevice) {
                
                var data = {
                    "action": "get_device",
                    "idDevice": idDevice
                };
                data = $(this).serialize() + "&" + $.param(data);
                
                $.ajax({
                    type: "GET",
                    dataType: "json",
                    url: "http://timwebapp-hypcourse2016.rhcloud.com/api/get_devices.php",
                    data: data,
                    
                    success: function(data) {
                        
                        console.log(data["json"]);
                        
                        get_img(data["idDevices"], data["colore_0"]["id_colore"]);
                        
                        
                        /*
                            Breadcrumb
                        */
                        $("#breadcrumb").append(
                            '<li class="active">'+data["nome"]+'</li>'
                        );
                        
                        /*
                            Nome + Flag
                        */
                        $("#nome_dispositivo").html(function(){
                            if(data["promo"] == 1)
                                return data["nome"]+'<span class="label label-warning">promo</span>';
                            else if(data["novita"] == 1)
                                return data["nome"]+'<span class="label label-warning">novità</span>';
                            else
                                return data["nome"];

                        });
                        
                        /*
                            Caratteristiche
                        */
                        $("#caratteristiche").html(
                            data["caratteristiche"]
                        );
                        
                        /*
                            Memoria
                        */
                        for(i=0; i<data["n_memoria"]; i++) {
                            if(data["memoria_0"]["dimensione"] != "nessuna")
                                $("#memoria").append(
                                    '<button type="button" class="btn btn-default">'+data["memoria_"+i]["dimensione"]+'</button>'
                                );
                        }
                        
                        /*
                            Colori
                        */
                        for(i=0; i<data["n_colori"]; i++) {
                            $("#colori_device").append(
                                '<div class="col-xs-2 col-sm-1 col-md-2 col-lg-1 no-padding"><div id="'+data["colore_"+i]["id_colore"]+'" class="device-color" style="background-color:'+data["colore_"+i]["codice_colore"]+'"></div></div>'
                            );
                            
                            if(i == 0) {
                                $("#"+data["colore_0"]["id_colore"]).addClass("active-color");
                            }
                               
                        }
                        
                        /*
                            Prezzo Intero
                        */
                        $("#prezzo_intero").html(
                            data["prezzo_intero"]+" €"
                        );
                        
                        /*
                            Prezzo Rateale
                        */
                        if(data["n_rate"] != 0) {
                            $("#prezzo_rate").html(
                                '<div class="checkbox"><label class="tim-cbtext"><input type="radio" name="optradio"> In '+data["n_rate"]+' rate senza interessi</label></div><p id="prezzo_rate" class="tim-pricetext">'+data["prezzo_rate"]+' €/mese'+'</p><p class="tim-u-cbtext">Se hai una linea di casa TIM</p>'
                            );
                        }
                        
                        /*
                            Link per l'acquisto
                        */
                        $("#link-acquista").html(
                            '<a href="carrello.html?idDevice='+idDevice+'" class="btn btn-primary btn-lg active tim-acquista">Acquista</a>'
                        );
                        
                        /*
                            Navigazione a Schede
                        */
                        if(data["specifiche"] != null) {
                            $("#myTab").append(
                                '<li class="active"><a href="#specifiche" data-toggle="tab">SPECIFICHE TECNICHE</a></li>'
                            );
                            
                            $("#myTabContent").append(
                                '<div class="tab-pane fade in active" id="specifiche">'+
                                '<p class="spaziotab">'+data["specifiche"]+'</p>'+
                                '</div>'
                            );
                        }
                        
                        if(data["descrizione"] != "") {
                            $("#myTab").append(
                                '<li><a href="#descrizione" data-toggle="tab">DESCRIZIONE</a></li>'
                            );
                                
                            $("#myTabContent").append(
                                '<div class="tab-pane fade" id="descrizione">'+
                                '<p class="spaziotab">'+data["descrizione"]+'</p>'+
                                '</div>'
                            );
                        }
                        
                        if(data["inclusi"] != "") {
                            $("#myTab").append(
                                '<li><a href="#inclusi" data-toggle="tab">INCLUSI NEL PREZZO</a></li>'
                            );
                            
                            $("#myTabContent").append(
                                '<div class="tab-pane fade" id="inclusi">'+
                                '<p class="spaziotab">'+data["inclusi"]+'</p>'+
                                '</div>'
                            );
                        }
                        
                        $("#myTab").append(
                            '<li><a href="#subsls" data-toggle="tab">SLS ABBINATI</a></li>'
                        );
                        $("#myTabContent").append(
                            '<div class="tab-pane fade" id="subsls">'
                        );
                        
                        if(data["n_subsls"]==0) {
                            $("#subsls").append(
                                '<p class="spaziotab">Nessun SLS abbinato disponibile</p>'
                            );
                        }
                        else {
                            for(i=0; i<data["n_subsls"]; i++) {
                                $("#subsls").append(
                                    '<p class="spaziotab">'+'<a href="sub_sls.html?idSubSLS='+data["subsls_"+i]["idSubSLS"]+'">'+data["subsls_"+i]["nome"]+'</a>'+'</p>'
                                );
                            }
                        }
                        $("#myTabContent").append(
                            '</div>'
                        );

                        $("#myTab").append(
                            '<li><a href="#assistance" data-toggle="tab">SERVIZI ASSISTENZA</a></li>'
                        );
                        $("#myTabContent").append(
                            '<div class="tab-pane fade" id="assistance">'
                        );
                        if(data["n_assistances"]==0) {
                            $("#assistance").append(
                                '<p class="spaziotab">Nessun AS abbinato disponibile</p>'
                            );
                        }
                        else {
                            for(i=0; i<data["n_assistances"]; i++) {
                                $("#assistance").append(
                                    '<p class="spaziotab">'+'<a href="assistenza.html?idAssistance='+data["assistance_"+i]["idAssistance"]+'">'+data["assistance_"+i]["titolo"]+'</a>'+'</p>'
                                );
                            }
                        }
                        $("#myTabContent").append(
                            '</div>'
                        );
                        
                        
                        /*
                            Evoca il metodo che rende le schede responsive
                        */
                        $('#myTab').tabCollapse();
                    }
                });
                
                return false;
                
            }
            
            function get_img(idDevice, idColore) {
                
                var data = {
                    "action": "get_img",
                    "idDevice": idDevice,
                    "idColore": idColore
                };
                data = $(this).serialize() + "&" + $.param(data);
                
                $.ajax({
                    type: "GET",
                    dataType: "json",
                    url: "http://timwebapp-hypcourse2016.rhcloud.com/api/get_devices.php",
                    data: data,
                    success: function(data) {
                        
                        console.log(data["json"]);
                        
                        /*
                            Pulisce il DOM in caso di inserimenti precedenti
                        */
                        $("#img_dev").html (
                            ""
                        );
                        $(".carousel-indicators").html (
                            ""
                        );
                        $(".carousel-inner").html (
                            ""
                        );
                            
                        for (i=0; i<data["n_immagini"]; i++) {
                            $("#img_dev").append (
                                '<a href="#" id="thmb_'+i+'" class="thumbnail"><img src="'+data["percorso_"+i]+'" alt=""></a>'
                            );
                            if(i==0) {
                                $(".carousel-indicators").append (
                                    '<li data-target="#myCarousel" data-slide-to="0" class="active"></li>'
                                );
                                $(".carousel-inner").append (
                                    '<div class="item active"><img src="'+data["percorso_"+i]+'"></div>'
                                );
                            }
                            else {
                                $(".carousel-indicators").append (
                                    '<li data-target="#myCarousel" data-slide-to="'+i+'"></li>'
                                );
                                $(".carousel-inner").append (
                                    '<div class="item"><img src="'+data["percorso_"+i]+'"></div>'
                                );
                            }
                        }
                            
                        $("#main_img").html(
                            '<img src="'+data["percorso_0"]+'" class="img-dev" alt="">'
                        );
                            
                    }
                });
                
                return false;
                
            }
            
        </script>
        
    </body>
    
</html>