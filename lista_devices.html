<!DOCTYPE html>
<html lang="it">
	
	<head>
		
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="description" content="Tim Project Hypermedia Application Course 2016">
		
		<title>
			TIM - Lista Devices
		</title>
		
		<link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/bootstrap-theme.css">
        <link rel="stylesheet" href="css/tim/tim-components.css">
        <link rel="stylesheet" href="css/tim/lista-devices.css">
        <link rel="stylesheet" href="css/tim/utility-classes.css">
        <link rel="stylesheet" href="css/tim/mobile.css">
		
	</head>
	
	<body>
        
     	<!-- MAIN HEADER -->
		<nav class="navbar navbar-default tim-header">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand timbrand" href="#">
						<img alt="TIM" src="img/logo.png">
					</a>
				</div>
                
                <div class="collapse navbar-collapse" id="header">
                    <ul class="nav navbar-nav">
                        <li><a href="#" style="color:white;">Chi siamo</a></li>
                        <li><a href="#" style="color:white;">Il gruppo</a></li>
                    </ul>
                    
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="#" style="color:white;">PRODOTTI</a></li>
                        <li><a href="#" style="color:white;">SMARTLIFE</a></li>
                        <li><a href="#" style="color:white;">ASSISTENZA</a></li>
                        <a class="navbar-brand cartbrand" href="#">
                            <img class="cartlogo" alt="Carrello" src="img/cart.png">
                        </a>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- FINE HEADER -->
				
        <ol class="breadcrumb">
            <li><a href="#">Prodotti</a></li>
            <li class="active">Categoria device</li>
        </ol>
        
        <div class="row tim-row">
            <div class="col-md-1 col-md-offset-1 col-xs-2">
                <img alt="#" src="#">    
            </div>
            
            <div class="col-md-5 col-xs-5">
                <p>Categoria device</p>
                <li><a href="#">Torna alle categorie</a></li>
            </div>
            
            <div class="col-md-4 col-xs-5">
                <p class="text-right">Consegna gratuita su tutti i prodotti</p>
                <div class="dropdown pull-right">
                    <button class="btn btn-default dropdown-toggle" type="button" id="ordinaper" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        Ordina per
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                        <li><a href="#">Ordine alfabetico</a></li>
                        <li><a href="#">Prezzo crescente</a></li>
                        <li><a href="#">Prezzo decrescente</a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="hidden-md hidden-lg">
            <a class="btn btn-primary collapsed pulsantefiltri" role="button" data-toggle="collapse" href="#menufiltri2" aria-expanded="false" aria-controls="menufiltri">Filtra per...</a>
            <div class="collapse row filtroresp" id="menufiltri2">
                <div class="col-sm-4 col-xs-12">
                    <form action="query_devices.php" method="post" id="filtri">
                        <label for="mostra solo">Mostra solo:</label>
                        <input type="checkbox" id="Promozione" name="Promozione">
                        <input type="checkbox" id="Novità" name="Novità">
                        <input type="checkbox" id="Disponibile" name="Disponibile">
                        <hr>
                        
                    </form>
                    <p class="filtroresp">Mostra solo  </p>
                    <div class="checkbox filtroresp">
                        <label><input type="checkbox"> I più venduti </label>
                    </div>
                    <div class="checkbox filtroresp">
                        <label><input type="checkbox"> In promozione </label>
                    </div>
                    <div class="checkbox filtroresp">
                        <label><input type="checkbox"> Novità </label>
                    </div>
                </div>
                
                <div class="col-sm-4 col-xs-12">
                    <p class="filtroresp"> Tipologia </p>
                    <div class="checkbox filtroresp">
                        <label><input type="checkbox"> Smartphone </label>
                    </div>
                    <div class="checkbox filtroresp">
                        <label><input type="checkbox"> iPhone </label>
                    </div>
                    <div class="checkbox filtroresp">
                        <label><input type="checkbox"> Telefoni di casa </label>
                    </div>
                </div>
                
                <div class="col-sm-4 col-xs-12">
                    <p class="filtroresp"> Prezzo </p>
                    <div class="checkbox filtroresp">
                        <label><input type="checkbox"> -200€ </label>
                    </div>
                    <div class="checkbox filtroresp">
                        <label><input type="checkbox"> 200€-500€ </label>
                    </div>
                    <div class="checkbox filtroresp">
                        <label><input type="checkbox"> +500€ </label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row tim-row">
            <div class="col-md-2 col-md-offset-1 hidden-xs hidden-sm">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Filtra per</h3>
                    </div>
                    <div class="panel-body">
                        <form action="" method="post" id="filtri">
                            <label for="mostra solo">Mostra solo</label>
                            <div class="radio">
                                <label><input type="radio" name="mostra_solo" value="disponibile"> Disponibile</label>
                                <br>
                                <label><input type="radio" name="mostra_solo" value="novita"> Novità</label>
                                <br>
                                <label><input type="radio" name="mostra_solo" value="promo"> Promozione</label>
                            </div>
                            <hr>
                            
                            <label for="tipologia">Tipologia</label>
                            <div id="tipologia">
                            </div>
                            <hr>
                            <label for="prezzo">Prezzo</label>
                            <div class="radio">
                                <label><input type="radio" name="prezzo" value="150"> &lt;150</label>
                                <br>
                                <label><input type="radio" name="prezzo" value="150-300"> 150-300</label>
                                <br>
                                <label><input type="radio" name="prezzo" value="300-400"> 300-400</label>
                                <br>
                                <label><input type="radio" name="prezzo" value="400"> &gt;400</label>
                            </div>
                            <hr>
                            
                            <label for="acquisto">Acquisto</label>
                            <div class="radio">
                                <label><input type="radio" name="acquisto" value="rate"> A rate</label>
                                <br>
                                <label><input type="radio" name="acquisto" value="unica"> Soluzione unica</label>
                            </div>             
                            <hr>
                            
                            <div id="sis_ope">
                            </div>
                            
                            <div id="connessione">
                            </div>
                            
                            <input type="submit" name="submit" value="Applica filtri">
                        </form>  
                    </div>
                </div>
            </div> 
            
            <div class="col-md-8 col-sm-12">
                <div id="devlist" class="row"><!-- Device List --></div>
            </div>
        </div>
    
        <script src="js/jquery-1.12.4.min.js"></script>
        <script src="js/bootstrap.js"></script>
        <script src="js/get.js"></script>
            
        <script>
        
            $(document).ready(function(){ 
    
                var heights = $(".rate").map(function(){ 
                    return $(this).height();
                }).get(),
                
                maxHeight = Math.max.apply(null, heights);
                $(".rate").height(maxHeight);
            
                var idCategoria = $_GET("idCategoria");
                getDevlist(idCategoria);
                getFiltri(idCategoria);
        
            });
            
            function getDevlist(idCategoria) {
                 
                var data = {
                    "action": "get_devlist",
                    "idCategoria": idCategoria
                };
                data = $(this).serialize() + "&" + $.param(data);
                
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: "query_devices.php",
                    data: data,
                    success: function(data) {
                        
                        console.log(data["json"]);
                        
                        /*
                            Lista Devices
                        */
                        for(var i=0; i<data["n_devices"]; i++) {
                            if(data["device_"+i]["prezzo_scontato"] != "0.00") {
                                $("#devlist").append(
                                    '<div class="col-md-3 col-sm-4 col-xs-12 colonne">'+
                                    '<div class="panel panel-default pannelli-store">'+
                                    '<span class="label label-warning pull-right etichette">PROMO</span>'+
                                    '<img class="devicepics" href="#" src="'+data['device_'+i]["percorso"]+'">'+
                                    '<p class="text-center">'+data['device_'+i]["nome"]+'</p>'+
                                    '<div class="row rigarespo" style="margin-bottom:10px"> <div class="col-md-5 col-md-offset-1 col-sm-5 col-sm-offset-1 text-center prezzi_scont col-scontati">'+data['device_'+i]["prezzo_intero"]+'€'+'</div><div class="col-md-5 col-sm-5 text-center prezzi col-scontati">'+data['device_'+i]["prezzo_scontato"]+'€</div></div>'+
                                    '<p class="rate">&nbsp;</p>'+
                                    '<a  href="pagina_prodotti.html"><button type="button" class="btn btn-default detail-button">DETTAGLI</button></a>'+
                                    '</div>'+
                                    '</div>'
                                );
                            }
                            else {
                                if(data['device_'+i]["n_rate"] != 0) {
                                    $("#devlist").append(
                                        '<div class="col-md-3 col-sm-4 col-xs-12 colonne">'+
                                        '<div class="panel panel-default pannelli-store">'+
                                        '<span class="label label-warning pull-right etichette">PROMO</span>'+
                                        '<img class="devicepics" href="#" src="'+data['device_'+i]["percorso"]+'">'+
                                        '<p class="text-center">'+data['device_'+i]["nome"]+'</p>'+
                                        '<p class="text-center prezzi">'+data['device_'+i]["prezzo_rate"]+'€/mese</p>'+
                                        '<p class="text-center rate">in '+data['device_'+i]["n_rate"]+' rate senza interessi</p>'+
                                        '<a  href="pagina_prodotti.html"><button type="button" class="btn btn-default detail-button">DETTAGLI</button></a>'+
                                        '</div>'+
                                        '</div>'
                                    );
                                }
                                else {
                                    if(data['device_'+i]["novita"] == 1) {
                                        $("#devlist").append(
                                            '<div class="col-md-3 col-sm-4 col-xs-12 colonne">'+
                                            '<div class="panel panel-default pannelli-store">'+
                                            '<span class="label label-primary pull-right etichette">NOVIT&#192;</span>'+
                                            '<img class="devicepics" href="#" src="'+data['device_'+i]["percorso"]+'">'+
                                            '<p class="text-center">'+data['device_'+i]["nome"]+'</p>'+
                                            '<p class="text-center prezzi">'+data['device_'+i]["prezzo_intero"]+'€</p>'+
                                            '<p class="rate">&nbsp;</p>'+
                                            '<a  href="pagina_prodotti.html"><button type="button" class="btn btn-default detail-button">DETTAGLI</button></a>'+
                                            '</div>'+
                                            '</div>'
                                        );
                                    }
                                    else {
                                        $("#devlist").append(
                                            '<div class="col-md-3 col-sm-4 col-xs-12 colonne">'+
                                            '<div class="panel panel-default pannelli-store">'+
                                            '<span class="label label-primary pull-right etichette" style="background-color:white;">&nbsp;</span>'+
                                            '<img class="devicepics" href="#" src="'+data['device_'+i]["percorso"]+'">'+
                                            '<p class="text-center">'+data['device_'+i]["nome"]+'</p>'+
                                            '<p class="text-center prezzi">'+data['device_'+i]["prezzo_intero"]+'€</p>'+
                                            '<p class="rate">&nbsp;</p>'+
                                            '<a  href="pagina_prodotti.html"><button type="button" class="btn btn-default detail-button">DETTAGLI</button></a>'+
                                            '</div>'+
                                            '</div>'
                                        );
                                    }
                                }
                            }
                        }
                    }
                });
                
                return false;
            }
            
            function getFiltri(idCategoria) {
                
                var data = {
                    "action": "get_filtri",
                    "idCategoria": idCategoria
                };
                data = $(this).serialize() + "&" + $.param(data);
                
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: "query_devices.php",
                    data: data,
                    success: function(data) {
                        
                        console.log(data["json"]);
                        
                        // TO DO
                        
                    }
                });
                
                return false;
            }
            
            function getFilteredlist(idCategoria) {
                
                var data = {
                    "action": "get_filteredlist",
                    "idCategoria": idCategoria
                    /*
                        Usare un form per queste variabili
                    */
                    /*"promo": ,
                    "novita": ,
                    "disponibile": ,
                    "tipologiaID": ,
                    "prezzo": ,
                    "marcaID": ,
                    "rate": ,
                    "sisopID": ,
                    "connessioneID": ,*/
                    /*
                        -> CREARE (PRENDERE) UNA VARIABILE PER OGNI FILTRO
                        Con un form viene più semplice (vedi esempio completo nella cartella esempi)
                    */
                };
                data = $(this).serialize() + "&" + $.param(data);
                
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: "query_devices.php", // -> Da finire la funzione
                    data: data,
                    success: function(data) {
                        
                        console.log(data["json"]);
                        
                        // TO DO
                        
                    }
                });
                
                return false;
            }
        
        </script>
    
    </body>
	
</html>